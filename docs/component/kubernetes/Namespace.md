### 什么是Namespace

在K8S里面的虚拟化集群，或独立的空间。

在逻辑上彼此隔离，但是不限制命名空间的通信。

在团队之间，组织之间提供不同的访问空间，在安全性，应用分类都能够提供帮助。

### 常见作用方式

- 不同角色和责任划分
- 区分不同场景
- 非多租户下的客户分区
- 应用归类
- 空间级的资源限制

### 自带的Namesapce

default：无指定时的均使用此空间

kube-system：K8S系统组件使用的空间

kube-public：公共资源空间，并不常用。

### Namespace粒度划分

- 小团队

  提供少量微服务5-10个，彼此沟通管理的成本比较低，很多操作仅靠人工即可完成。

  此种场景下，使用默认的default命名空间是个比较好的选择；

  如果有多个不同的场景，例如：test，prod，develop等，可单独创建出命名空间。

- 快速成长团队

  超过10个微服务，每个人都知道自己的微服务，也大致知道其他的微服务是如何联合工作的。但彼此间的协调和沟通变得越来越困难。在本地启动整个业务变得越来越困难。

  例如：已经不太能够列举出所有的服务，无法针对每个服务配置采集的日志等。

  此种场景下，每个团队可选择自己的命名空间，以及可选的不同场景的空间。

- 大公司

  每个人都不一定了解其他的业务或服务，使用服务契约进行彼此间的通信，或者使用服务网格。

  因此每个团队都应该有一个或者多个自己的命名空间。

  配置好访问空间的RBAC和资源限制是比较好的选择。

### 方案

1. K8S原生使用的空间kube-system保持不变。

   metrics，coredns等

2. 对平台支撑组件，也需要暴露给其他微服务的，基本作为系统运行都需要的组件。定义为一个空间，例如：数据库等，使用platform等。

   MySQL，ES，Kafka，Redis，Redis，

3. 提供平台管理面支撑的，但是对其他微服务不感知或若感知的，部分内容支持可能是可选的，是定义为一个命名空间，使用类似：maintain。

   zipkin，fluentd，prometheus，grafana，loki

4. 由第三方的业务提供

   业务提供命名空间，如果需要细分由业务各自定义

   

### 变更影响

1. 内部访问方式的变更

   在同一个命名空间下，使用 service:port 既可完成访问，如果是跨命名空间，需要加上FQDN的路径：service.namespace.cluster.local进行访问。

   **在场景中：**

   各个命名空间中都认为是可以通过缩略的FQDN名称，既仅保留service就可以进行访问。 例如：dems空间的各个业务均使用服务名称进行相互访问。

2. 外部访问变更

   在同一场景下，对外提供的访问方式不发生变更，如果是多场景，可能会提供不同的端口。

   **在场景中：**

   跨命名空间，需要包含FQDN的全称，例如需要访问数据库：mysql.platform.cluster.local

3. 观察者访问变更

   对命名空间进行分类，后续的管理面和业务面也进行相应的分类。

   管理面支撑中，可能会要求采集日志，查看监控等，因此，需要按照不同的命名空间进行粗粒度分类。
   
   比如：对用户呈现的Grafana页面，日志搜索仅显示dems下的日志内容
   
4. 定义RBAC

   例如：监控，日志等。

### 